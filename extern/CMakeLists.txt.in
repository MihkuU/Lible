cmake_minimum_required(VERSION 3.20)

project(lible_external_libs)

include(ExternalProject)

cmake_host_system_information(RESULT nprocs QUERY NUMBER_OF_PHYSICAL_CORES)

# armadillo library
set(arma_dir "@CMAKE_BINARY_DIR@/extern/arma")
ExternalProject_Add(arma
	URL 					   "@CMAKE_SOURCE_DIR@/extern/armadillo-12.4.1.tar.xz"
	SOURCE_DIR 		           "${arma_dir}"
    CONFIGURE_COMMAND 
		${CMAKE_COMMAND} -E env "${arma_dir}/configure" "${arma_dir}/"
	BUILD_COMMAND     
		${CMAKE_COMMAND} ${arma_dir} . -DCMAKE_INSTALL_PREFIX:PATH=${arma_dir}/build -DBUILD_SHARED_LIBS=OFF
    TEST_COMMAND      ""
	BUILD_ALWAYS	  		   OFF
	DOWNLOAD_EXTRACT_TIMESTAMP FALSE
)

# fmt library
set(fmt_dir "@CMAKE_BINARY_DIR@/extern/fmt")
ExternalProject_Add(fmt
	URL 			           "@CMAKE_SOURCE_DIR@/extern/fmt-master.zip"
	SOURCE_DIR                 "${fmt_dir}"
	CONFIGURE_COMMAND          ""
	BUILD_COMMAND 	           ""
	INSTALL_COMMAND            ""
	TEST_COMMAND               ""
    BUILD_ALWAYS               OFF
	DOWNLOAD_EXTRACT_TIMESTAMP FALSE
)

# json library
set(json_dir "@CMAKE_BINARY_DIR@/extern/json")
ExternalProject_Add(json
	URL                        "@CMAKE_SOURCE_DIR@/extern/json-develop.zip"
	SOURCE_DIR                 "${json_dir}"
	CONFIGURE_COMMAND          ""
	BUILD_COMMAND              ""
	INSTALL_COMMAND            ""
	TEST_COMMAND               ""
	BUILD_ALWAYS			   OFF
	DOWNLOAD_EXTRACT_TIMESTAMP FALSE
)

# mpl library
if(@USE_MPI@)
	set(mpl_dir "@CMAKE_BINARY_DIR@/extern/mpl")
	ExternalProject_Add(mpl
		URL	                       "@CMAKE_SOURCE_DIR@/extern/mpl-master.zip"
    	SOURCE_DIR                 "${mpl_dir}"
	    CONFIGURE_COMMAND          
			${CMAKE_COMMAND} -S "${mpl_dir}" -B "${mpl_dir}/build" -DCMAKE_INSTALL_PREFIX:PATH=${mpl_dir}/build
	    BUILD_COMMAND              "" 
	    INSTALL_COMMAND            
			${CMAKE_COMMAND} --install "${mpl_dir}/build"
	    TEST_COMMAND               ""
		BUILD_ALWAYS			   OFF
	    DOWNLOAD_EXTRACT_TIMESTAMP FALSE
	)
endif()

set(ankerl_dense_dir "@CMAKE_BINARY_DIR@/extern/unordered_dense")
ExternalProject_Add(ankerl_dense
	URL						   "@CMAKE_SOURCE_DIR@/extern/unordered_dense-main.zip"
	SOURCE_DIR				   "${ankerl_dense_dir}"
	CONFIGURE_COMMAND
		${CMAKE_COMMAND} -S "${ankerl_dense_dir}" -B "${ankerl_dense_dir}/build" -DCMAKE_INSTALL_PREFIX:PATH=${ankerl_dense_dir}/build
	BUILD_COMMAND
		${CMAKE_COMMAND} --build "${ankerl_dense_dir}/build"
	INSTALL_COMMAND
		${CMAKE_COMMAND} --install "${ankerl_dense_dir}/build"
	TEST_COMMAND
	BUILD_ALWAYS               OFF
	DOWNLOAD_EXTRACT_TIMESTAMP FALSE
)
